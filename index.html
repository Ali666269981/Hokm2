<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ú©Ù… Ø¯Ùˆ Ù†ÙØ±Ù‡ - Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
  <style>
    body {
      font-family: 'Tahoma', Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      text-align: center;
      direction: rtl;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }
    #status {
      font-size: 1.2em;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
    }
    #trump {
      margin: 20px 0;
    }
    #trump button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 1.1em;
      background: #ff6f61;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    #trump button:hover {
      transform: scale(1.05);
    }
    #cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }
    .card {
      width: 100px;
      height: 150px;
      background-size: cover;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
    }
    #trick {
      margin: 20px 0;
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 8px;
    }
    #currentTrick img {
      width: 80px;
      height: 120px;
      margin: 5px;
      border-radius: 5px;
    }
    #tricks {
      font-size: 1.5em;
      color: #ffd700;
    }
    #restartBtn {
      padding: 10px 20px;
      font-size: 1.1em;
      background: #4caf50;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s;
      margin-top: 20px;
    }
    #restartBtn:hover {
      transform: scale(1.05);
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø®Ø´ Ú†Øª */
    #chat {
      margin-top: 30px;
      max-width: 600px;
      margin-right: auto;
      margin-left: auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    #chatMessages {
      height: 200px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.2);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      text-align: right;
    }
    #chatInput {
      padding: 10px;
      width: 70%;
      border-radius: 5px;
      border: none;
      outline: none;
      font-size: 1em;
    }
    #chatSendBtn {
      padding: 10px 20px;
      font-size: 1.1em;
      background: #2196F3;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s;
      margin-right: 5px;
    }
    #chatSendBtn:hover {
      transform: scale(1.05);
    }
    /* Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø§ÛŒÙ…ÙˆØ¬ÛŒ */
    #emojiPicker {
      margin-top: 10px;
    }
    .emoji {
      cursor: pointer;
      font-size: 1.5em;
      margin: 0 5px;
      transition: transform 0.2s;
    }
    .emoji:hover {
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <h1>Ø­Ú©Ù… Ø¯Ùˆ Ù†ÙØ±Ù‡</h1>
  <p id="status">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯ÙˆÙ…...</p>
  <div id="trump" style="display: none;">
    <button onclick="setTrump('hearts')">â™¥ Ø¯Ù„</button>
    <button onclick="setTrump('diamonds')">â™¦ Ø®Ø´Øª</button>
    <button onclick="setTrump('clubs')">â™£ Ú¯Ø´Ù†ÛŒØ²</button>
    <button onclick="setTrump('spades')">â™  Ù¾ÛŒÚ©</button>
  </div>
  <div id="cards"></div>
  <div id="trick">ØªØ±ÙÙ†Ø¯ ÙØ¹Ù„ÛŒ: <span id="currentTrick"></span></div>
  <p>Ø§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: <span id="tricks">0</span></p>
  <button id="restartBtn" style="display:none;" onclick="restartGame()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§Ø²ÛŒ</button>
  
  <!-- Ø¨Ø®Ø´ Ú†Øª Ø¨Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø§ÛŒÙ…ÙˆØ¬ÛŒ -->
  <div id="chat">
    <div id="chatMessages"></div>
    <input type="text" id="chatInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
    <button id="chatSendBtn">Ø§Ø±Ø³Ø§Ù„</button>
    <div id="emojiPicker">
      <span class="emoji" onclick="insertEmoji('ğŸ˜€')">ğŸ˜€</span>
      <span class="emoji" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span>
      <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
      <span class="emoji" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
      <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
      <span class="emoji" onclick="insertEmoji('ğŸ™Œ')">ğŸ™Œ</span>
    </div>
  </div>

  <script>
    const ws = new WebSocket('wss://Hokm2.onrender.com');
    let playerId, isRuler, currentCards = [];

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'connected') {
        playerId = data.playerId;
        document.getElementById('status').innerText = data.message;
      } else if (data.type === 'gameStart') {
        document.getElementById('status').innerText = 'Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯! Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§Øª Ø±Ùˆ Ø¨Ø¨ÛŒÙ†.';
        isRuler = data.isRuler;
        if (isRuler) {
          document.getElementById('trump').style.display = 'block';
          document.getElementById('status').innerText += ' ØªÙˆ Ø­Ø§Ú©Ù…ÛŒØŒ ÛŒÙ‡ Ø®Ø§Ù„ Ø­Ú©Ù… Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†!';
        }
        document.getElementById('restartBtn').style.display = 'none';
        currentCards = data.cards;
        showCards(currentCards);
      } else if (data.type === 'trumpSet') {
        document.getElementById('status').innerText = `Ø­Ú©Ù…: ${translateSuit(data.suit)}`;
        document.getElementById('trump').style.display = 'none';
      } else if (data.type === 'cardPlayed') {
        const trickSpan = document.getElementById('currentTrick');
        const img = document.createElement('img');
        img.src = `https://deckofcardsapi.com/static/img/${data.card.rank}${data.card.suit[0].toUpperCase()}.png`;
        trickSpan.appendChild(img);
      } else if (data.type === 'updateCards') {
        currentCards = data.cards;
        showCards(currentCards);
      } else if (data.type === 'trickResolved') {
        document.getElementById('currentTrick').innerHTML = '';
        document.getElementById('tricks').innerText = playerId === 1 ? data.player1Tricks : data.player2Tricks;
        document.getElementById('status').innerText = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${data.winner} ØªØ±ÙÙ†Ø¯ Ø±Ùˆ Ø¨Ø±Ø¯! Ù†ÙˆØ¨Øª Ø¨Ø§Ø²ÛŒÚ©Ù† ${data.winner}`;
      } else if (data.type === 'gameOver') {
        document.getElementById('status').innerText = `Ø¨Ø§Ø²ÛŒ ØªÙ…ÙˆÙ… Ø´Ø¯! Ø¨Ø±Ù†Ø¯Ù‡: Ø¨Ø§Ø²ÛŒÚ©Ù† ${data.winner}`;
        document.getElementById('cards').innerHTML = '';
        document.getElementById('restartBtn').style.display = 'inline-block';
      } else if (data.type === 'chatMessage') {
        addChatMessage(data);
      } else if (data.type === 'error') {
        document.getElementById('status').innerText = data.message;
      }
    };

    function showCards(cards) {
      const cardsDiv = document.getElementById('cards');
      cardsDiv.innerHTML = '';
      cards.forEach(card => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'card';
        cardDiv.style.backgroundImage = `url(https://deckofcardsapi.com/static/img/${card.rank}${card.suit[0].toUpperCase()}.png)`;
        cardDiv.onclick = () => playCard(card);
        cardsDiv.appendChild(cardDiv);
      });
    }

    function setTrump(suit) {
      ws.send(JSON.stringify({ type: 'setTrump', suit }));
    }

    function playCard(card) {
      ws.send(JSON.stringify({ type: 'playCard', card }));
    }

    function restartGame() {
      ws.send(JSON.stringify({ type: 'restartGame' }));
    }

    function translateSuit(suit) {
      const suits = { hearts: 'Ø¯Ù„ â™¥', diamonds: 'Ø®Ø´Øª â™¦', clubs: 'Ú¯Ø´Ù†ÛŒØ² â™£', spades: 'Ù¾ÛŒÚ© â™ ' };
      return suits[suit];
    }

    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ú†Øª
    document.getElementById('chatSendBtn').addEventListener('click', () => {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (message) {
        ws.send(JSON.stringify({ type: 'chatMessage', message }));
        input.value = '';
      }
    });
    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ø§ Ø²Ø¯Ù† Enter
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('chatSendBtn').click();
      }
    });

    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ú†Øª Ø¯Ø± Ù†Ø§Ø­ÛŒÙ‡ Ú†Øª
    function addChatMessage(data) {
      const chatMessages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.style.marginBottom = '8px';
      messageDiv.innerText = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${data.playerId}: ${data.message}`;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // ØªØ§Ø¨Ø¹ Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ú†Øª
    function insertEmoji(emoji) {
      const input = document.getElementById('chatInput');
      input.value += emoji;
      input.focus();
    }
  </script>
</body>
</html>
